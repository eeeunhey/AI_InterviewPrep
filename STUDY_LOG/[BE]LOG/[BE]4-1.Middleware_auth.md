ì¢‹ìŠµë‹ˆë‹¤ ğŸ˜Š ì˜¬ë ¤ì£¼ì‹  ì½”ë“œëŠ” **JWT ì¸ì¦ ë¯¸ë“¤ì›¨ì–´**ì˜ˆìš”. í•˜ë‚˜ì”© í•´ì„í•´ë“œë¦´ê²Œìš”.

---

## 1. import ë¶€ë¶„

```js
const jwt = require("jsonwebtoken");
const User = require("../models/User");
```
* `jsonwebtoken`: í† í°ì„ ë°œê¸‰í•˜ê³  ê²€ì¦í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬.
* `User`: MongoDBì˜ ì‚¬ìš©ì ëª¨ë¸. (DBì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©ë¨)

---

## 2. protect ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜
```js
const protect = async (req, res, next) => {
    try {
        let token = req.headers.authorization
```
* `req.headers.authorization`: HTTP ìš”ì²­ í—¤ë”ì— ë‹´ê¸´ ì¸ì¦ í† í°ì„ ê°€ì ¸ì˜´.
  ë³´í†µ `"Bearer <í† í°ê°’>"` í˜•íƒœë¡œ ì „ë‹¬ë¼ìš”.

---

### 2-1. í† í° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
```js
if (token && token.startsWith("Bearer")) {
```

* í† í°ì´ ìˆê³  `"Bearer"` ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸.
  (ì¦‰, ì˜¬ë°”ë¥¸ í˜•ì‹ì¸ì§€ ì²´í¬)

---

### 2-2. í† í° ë¶„ë¦¬
```js
token = token.split(" ")[1];
```

* `"Bearer abcd1234..."` â†’ `"abcd1234..."` ë§Œ ì¶”ì¶œ.

---

### 2-3. í† í° ê²€ì¦ & ìœ ì € ì¡°íšŒ
```js
const decoded = jwt.verify(token, process.env.JWT_SECRET);
req.user = await User.findById(decoded.id).select("-password");
next();
```

* `jwt.verify`: í† í°ì´ ìœ íš¨í•œì§€ ê²€ì‚¬í•˜ê³ , ì•ˆì— ìˆëŠ” payload(ì‚¬ìš©ì ì •ë³´)ë¥¼ êº¼ëƒ„.
* `decoded.id`: í† í° ì•ˆì— ë‹´ê¸´ `id` ê°’. (í† í° ìƒì„± ì‹œ `jwt.sign({id: user._id}, ...)` ì‹ìœ¼ë¡œ ë„£ì—ˆë˜ ê²ƒ)
* `User.findById(decoded.id)`: DBì—ì„œ í•´ë‹¹ ìœ ì € ì¡°íšŒ.
* `.select("-password")`: ë¹„ë°€ë²ˆí˜¸ í•„ë“œëŠ” ë¹¼ê³  ê°€ì ¸ì˜´.
* `req.user`ì— ë‹´ì•„ë‘ë©´ ì´í›„ ë¼ìš°í„°ì—ì„œ `req.user`ë¡œ ë¡œê·¸ì¸í•œ ìœ ì € ì •ë³´ì— ì ‘ê·¼ ê°€ëŠ¥.
* `next()`: ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´/ë¼ìš°í„°ë¡œ ë„˜ì–´ê°.

---

### 2-4. í† í° ì—†ê±°ë‚˜ ì˜ëª»ëœ ê²½ìš°

```js
} else {
    res.status(401).json({ message: "Not authorized, no token"});
}
```

* ì•„ì˜ˆ í† í°ì´ ì—†ìœ¼ë©´ **401 Unauthorized** ì‘ë‹µ.

```js
} catch (error) {
    res.status(401).json({ message: "Token failed", error: error.message});
}
```

* í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëì„ ê²½ìš° â†’ **401 Unauthorized** ì‘ë‹µ.

---

## 3. ëª¨ë“ˆ ë‚´ë³´ë‚´ê¸°

```js
module.exports = { protect };
```

* `protect` ë¯¸ë“¤ì›¨ì–´ë¥¼ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ export.
  (ë¼ìš°í„°ì—ì„œ `router.get("/profile", protect, getUserProfile)` ì´ëŸ° ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥)

---

âœ… **ì •ë¦¬**
ì´ ë¯¸ë“¤ì›¨ì–´ëŠ”:

1. ìš”ì²­ í—¤ë”ì—ì„œ `"Bearer í† í°"`ì„ í™•ì¸
2. í† í°ì´ ìœ íš¨í•˜ë©´ `req.user`ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ë„£ìŒ
3. ì´í›„ ë¼ìš°íŠ¸ì—ì„œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ì— ì ‘ê·¼ ê°€ëŠ¥
4. í† í°ì´ ì—†ê±°ë‚˜ ì˜ëª»ë˜ë©´ `401 Unauthorized` ì‘ë‹µ

---

í˜¹ì‹œ ì œê°€ `ë¼ìš°í„°ì—ì„œ protect ì“°ëŠ” ì˜ˆì‹œ`ê¹Œì§€ ë“¤ì–´ë“œë¦´ê¹Œìš”?
