ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘ ì´ ì½”ë“œëŠ” **íŒŒì¼ ì—…ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” `multer` ì„¤ì • íŒŒì¼**ì´ì—ìš”. í•˜ë‚˜ì”© í•´ì„í•´ë“œë¦´ê²Œìš”.

---

## 1. `multer` ë¶ˆëŸ¬ì˜¤ê¸°

```js
const multer = require('multer');
```
* Node.jsì—ì„œ íŒŒì¼ ì—…ë¡œë“œë¥¼ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬.

---

## 2. ì €ì¥ì†Œ(storage) ì„¤ì •

```js
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        cb(null, 'uploads/');
    },
    filename: (req, file, cb) => {
        cb(null, `${Date.now()}-${file.originalname}`);
    },
});
```

* `diskStorage`: íŒŒì¼ì„ ë¡œì»¬ ë””ìŠ¤í¬(`uploads/` í´ë”)ì— ì €ì¥í•˜ë„ë¡ ì„¤ì •.
* `destination`: ì—…ë¡œë“œëœ íŒŒì¼ì´ ì €ì¥ë  ê²½ë¡œ â†’ ì—¬ê¸°ì„œëŠ” `uploads/` í´ë”.
* `filename`: ì €ì¥ë  íŒŒì¼ ì´ë¦„ ì§€ì •
  ì˜ˆ: `1704356789012-profile.png` (ì—…ë¡œë“œ ì‹œê° + ì›ë³¸ íŒŒì¼ëª…).

---

## 3. íŒŒì¼ í•„í„°(fileFilter)

```js
const fileFilter = (req, file, cb) => {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg'];
    if (allowedTypes.includes(file.mimetype)) {
        cb(null, true);
    } else {
        cb(new Error('Only .jpg, ,jpg and .png formats are allowed'), false);
    }
};
```

* ì—…ë¡œë“œë˜ëŠ” íŒŒì¼ì˜ MIME íƒ€ì… ì²´í¬.
* `allowedTypes`: í—ˆìš©ëœ íŒŒì¼ í˜•ì‹ â†’ `jpeg`, `jpg`, `png`.
* íŒŒì¼ í˜•ì‹ì´ ë§ìœ¼ë©´ `cb(null, true)` â†’ ì—…ë¡œë“œ í—ˆìš©.
* ì•„ë‹ˆë©´ `cb(new Error(...), false)` â†’ ì—…ë¡œë“œ ê±°ë¶€.

ğŸ‘‰ `"Only .jpg, .jpeg and .png formats are allowed"` í˜•ì‹ ì§€ì •

---

## 4. ì—…ë¡œë“œ ê°ì²´ ìƒì„±

```js
const upload = multer({ storage, fileFilter });
```
* ì €ì¥ì†Œ + í•„í„° ì ìš©ëœ `multer` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±.

---

## 5. ë‚´ë³´ë‚´ê¸°

```js
module.exports = upload;
```

* ë‹¤ë¥¸ íŒŒì¼ì—ì„œ `upload`ë¥¼ ë¶ˆëŸ¬ì„œ ì‚¬ìš© ê°€ëŠ¥.

---

âœ… **ì •ë¦¬**

* ì´ ì½”ë“œëŠ” **ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¯¸ë“¤ì›¨ì–´**.
* `uploads/` í´ë”ì—ë§Œ ì €ì¥í•˜ê³ , íŒŒì¼ëª…ì€ **í˜„ì¬ì‹œê°„ + ì›ë³¸íŒŒì¼ëª…**ìœ¼ë¡œ ì €ì¥.
* ì—…ë¡œë“œ í—ˆìš© í™•ì¥ì: `.jpeg`, `.jpg`, `.png`.

---

ì˜ˆë¥¼ ë“¤ì–´, `Express ë¼ìš°í„°`ì—ì„œ ì´ë ‡ê²Œ ì“¸ ìˆ˜ ìˆì–´ìš”:

```js
const express = require('express');
const router = express.Router();
const upload = require('../middleware/upload');

// ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ (input name="profileImage")
router.post('/upload', upload.single('profileImage'), (req, res) => {
    res.json({
        message: 'íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ!',
        file: req.file
    });
});

module.exports = router;
```

ğŸ‘‰ ê·¸ëŸ¬ë©´ `POST /upload` ìš”ì²­ ì‹œ `form-data`ì— `profileImage` í‚¤ë¡œ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥


